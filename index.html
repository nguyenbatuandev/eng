<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Luyện trắc nghiệm 5 đề – Đúng/Sai + giải thích (chọn đề / trộn 45 câu)</title>
<style>
  :root{
    --ok:#16a34a;      /* xanh lá */
    --bad:#ef4444;     /* đỏ */
    --pri:#2563eb;     /* xanh dương */
    --muted:#64748b;   /* slate-500 */
    --card:#ffffff;    /* nền thẻ */
    --ink:#0f172a;     /* slate-900 */
    --ink-dim:#334155; /* slate-700 */
    --bg1:#f7fafc;     /* nền sáng */
    --shadow:0 10px 32px rgba(2,6,23,.06), 0 1px 1px rgba(2,6,23,.04);
  }
  html,body{
    margin:0;
    background:var(--bg1) linear-gradient(180deg,#ffffff, #f5f8ff 60%, #eef4ff);
    color:var(--ink);
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
    -webkit-tap-highlight-color: transparent;
  }

  /* Layout responsive */
  .wrap{max-width:1100px;margin:24px auto;padding:16px}
  @media(min-width:768px){.wrap{padding:20px}}
  .title{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between}
  .title h1{font-size:clamp(18px,2.2vw,24px);margin:0;font-weight:800;color:#0b1220}

  /* Top bar */
  .toolbar{
    position:sticky;top:0;z-index:5;
    display:flex;gap:8px;flex-wrap:wrap;margin:12px 0;padding:10px;
    backdrop-filter:saturate(160%) blur(6px);
    background:rgba(255,255,255,.85);border:1px solid #e7ecff;border-radius:14px;
    box-shadow:0 6px 20px rgba(2,6,23,.06);
  }
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .score{
    font-weight:700;border:1px solid #e5e7eb;border-radius:14px;padding:10px 14px;background:#fff;
    box-shadow:var(--shadow)
  }

  .btn, select, .search input{
    border:1px solid #e5e7eb;background:#ffffff;color:var(--ink);
    padding:12px 14px;border-radius:12px;font-weight:700;
    box-shadow:0 1px 2px rgba(2,6,23,.05);transition:transform .06s ease, box-shadow .12s ease, background .12s ease
  }
  .btn{cursor:pointer}
  .btn:hover{background:#f8fafc;box-shadow:0 6px 20px rgba(2,6,23,.08), 0 1px 2px rgba(2,6,23,.03);transform:translateY(-1px)}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  select,.search input{font-weight:600}
  .search{flex:1;min-width:180px}
  .search input:focus, select:focus{outline:none;border-color:#93c5fd;box-shadow:0 0 0 3px rgba(59,130,246,.15)}
  .pill{border:1px solid #e7eaf0;background:#fff;border-radius:999px;padding:4px 8px}

  /* Cards */
  .card{
    border:1px solid #e7eaf0;border-radius:16px;padding:14px;margin:12px 0;background:var(--card);
    box-shadow:var(--shadow)
  }
  @media(min-width:768px){.card{padding:16px;margin:14px 0}}
  .qhead{display:flex;gap:12px;align-items:flex-start}
  .qid{
    min-width:56px;height:32px;display:inline-flex;align-items:center;justify-content:center;
    border-radius:999px;border:1px solid #e7eaf0;background:#eef6ff;color:#1e40af;font-weight:800
  }
  .qtext{font-size:clamp(15px,2vw,17px);line-height:1.55}

  .opts{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
  @media(min-width:780px){.opts{grid-template-columns:repeat(2,1fr)}}
  .opt{
    border:1px solid #e7eaf0;background:#ffffff;border-radius:12px;padding:14px;cursor:pointer;position:relative;text-align:left;
    transition:border-color .12s ease, box-shadow .12s ease, transform .06s ease; touch-action:manipulation;
  }
  .opt:hover{border-color:#bfdbfe;box-shadow:0 6px 16px rgba(2,6,23,.07);transform:translateY(-1px)}
  .opt .label{font-weight:800;color:#2563eb;margin-right:8px}
  .opt.correct{border-color:var(--ok);box-shadow:0 0 0 2px rgba(22,163,74,.15), 0 10px 24px rgba(22,163,74,.10)}
  .opt.wrong{border-color:var(--bad);box-shadow:0 0 0 2px rgba(239,68,68,.15), 0 10px 24px rgba(239,68,68,.10)}
  .opt.locked{cursor:not-allowed;opacity:.95}

  .explain{
    margin-top:10px;font-size:15px;color:#14532d;
    background:linear-gradient(180deg,#ecfdf5,#e6fff3);
    border:1px solid #a7f3d0;padding:12px;border-radius:12px;display:none
  }
  .explain.show{display:block}

  .legend{display:flex;gap:10px;flex-wrap:wrap;align-items:center;font-size:13px;color:#475569;margin-top:6px}
  .tag{padding:4px 10px;border-radius:999px;border:1px solid #e7eaf0;background:#ffffff}
  .footer{margin:22px 0;color:#64748b;font-size:13px}

  /* rung nhẹ khi chọn sai (đẹp hơn trên mobile) */
  @keyframes shake{ 10%,90%{transform:translateX(-1px)} 20%,80%{transform:translateX(2px)} 30%,50%,70%{transform:translateX(-4px)} 40%,60%{transform:translateX(4px)} }
  .opt.wrong{ animation:shake .4s both; }
</style>
</head>
<body>
<div class="wrap">
  <div class="title">
    <h1>Trắc nghiệm 5 đề • Chọn đề / Trộn 45 câu • Bấm để hiện Đúng/Sai + Giải thích</h1>
    <div class="row">
      <div class="score">Điểm: <span id="score">0</span>/<span id="total">0</span></div>
    </div>
  </div>

  <div class="toolbar">
    <label class="pill">
      <select id="modeSelect" aria-label="Chọn chế độ làm bài">
        <option value="mix45">Trộn 5 đề (45 câu ngẫu nhiên)</option>
        <option value="de1">Luyện theo Đề 1 (50 câu)</option>
        <option value="de2">Luyện theo Đề 2 (50 câu)</option>
        <option value="de3">Luyện theo Đề 3 (50 câu)</option>
        <option value="de4">Luyện theo Đề 4 (50 câu)</option>
        <option value="de5">Luyện theo Đề 5 (50 câu)</option>
      </select>
    </label>
    <button class="btn" id="btnStart">Bắt đầu / Tạo đề</button>
    <button class="btn" id="btnShuffle" title="Chỉ trộn ở chế độ Trộn 5 đề">Xáo trộn lại</button>
    <button class="btn" id="btnShowAll">Hiện đáp án + giải thích (tất cả)</button>
    <button class="btn" id="btnReset">Làm lại</button>
    <div class="search" style="flex:1">
      <input id="search" placeholder="Lọc câu theo từ khóa: since, passive, deadline…" aria-label="Lọc câu hỏi">
    </div>
  </div>

  <div class="legend">
    <span class="tag">Chọn đáp án → xem Đúng/Sai + Giải thích</span>
    <span class="tag">Nếu chọn sai: hiển thị NGAY đáp án đúng (chữ cái + nội dung)</span>
    <span class="tag">Chỉ “Trộn 5 đề (45 câu)” mới xáo thứ tự câu</span>
  </div>

  <div id="quiz" aria-live="polite"></div>
  <div class="footer">Mẹo: Dùng ô tìm kiếm để lọc nhanh theo chủ điểm/ngữ pháp.</div>
</div>

<script>
/* ================================================================
   TRẮC NGHIỆM 5 ĐỀ — DỮ LIỆU & LOGIC HIỂN THỊ (BẢN ĐÃ FIX)
   - Khi chọn sai: hiện ngay đáp án đúng + giải thích
   - Chữ cái đáp án đúng (A/B/C/D) hiển thị theo vị trí sau khi xáo
================================================================ */

/* =================== DỮ LIỆU 5 ĐỀ =================== */
/* a = chỉ số đúng trong mảng c (0=A,1=B,2=C,3=D)
   e = giải thích ngắn gọn, chuẩn & nhất quán */
const DE1 = [
{n:101,q:"The car_____ to my uncle.",c:["belongs","are belonging","belong","belonging"],a:0,e:"Động từ trạng thái 'belong' không dùng tiếp diễn. Cấu trúc: belong to + người."},
{n:102,q:"She _____ yawns in English class.",c:["sometimes","already","sometime","though"],a:0,e:"Trạng từ tần suất (always/usually/often/sometimes/rarely/never) đặt trước động từ thường."},
{n:103,q:"I _____ to watch comedies on TV.",c:["liking","likes","am liking","like"],a:3,e:"Thói quen/sở thích chung dùng hiện đơn: I like …"},
{n:104,q:"They _____ at two o’clock tomorrow.",c:["arrived","have arrived","are arriving","have been arriving"],a:2,e:"Lịch hẹn/có thời gian cụ thể trong tương lai gần → hiện tiếp diễn: are arriving at 2 o’clock."},
{n:105,q:"When I arrived at my aunt’s home, she _____ her kitchen floor.",c:["was sweeping","sweep","had sweeping","sweeps"],a:0,e:"QKTD diễn tả hành động đang xảy ra khi QKĐ chen vào: was sweeping … when I arrived."},
{n:106,q:"It _____ for two days when I arrived in town.",c:["rained","rains","has been raining","had been raining"],a:3,e:"QKHTTD (had been V-ing) diễn tả hành động kéo dài tới một mốc quá khứ."},
{n:107,q:"He sometimes _____ money from his parents.",c:["lend","lends","borrow","borrows"],a:3,e:"Borrow (mượn) + from; chủ ngữ He → borrows."},
{n:108,q:"We’ll get there _____ six o’clock.",c:["before","on","ago","in"],a:0,e:"Before + mốc thời gian: trước 6 giờ."},
{n:109,q:"We all look forward _____ you very soon.",c:["to see","will see","to seeing","like seeing"],a:2,e:"Look forward to + V-ing."},
{n:110,q:"Last weekend, we went horseback _____ on the farm.",c:["ride","riding","rode","ridden"],a:1,e:"Go + V-ing cho hoạt động giải trí: go riding."},
{n:111,q:"My back is sore because I forgot _____ before I exercised.",c:["to stretch","stretching","stretched","stretch"],a:0,e:"Forget to V = quên chưa làm điều gì."},
{n:112,q:"Several students from the suburbs ______ buses to school.",c:["get on","getting on","take","taking"],a:2,e:"Thói quen → take buses to school."},
{n:113,q:"Why haven’t you _____ your hair yet?",c:["comb","combed","to comb","combing"],a:1,e:"Hiện hoàn thành → V3: combed."},
{n:114,q:"My boss told me _____ the project by this Friday.",c:["finish","to finish","finishing","to finishing"],a:1,e:"Tell + O + to V."},
{n:115,q:"It is difficult _____ from England to France.",c:["row","rowed","to row","row to"],a:2,e:"Adj + to V: difficult to row."},
{n:116,q:"I don’t have time _____ for the cheapest car.",c:["look","looked","to look","looking"],a:2,e:"Time + to V (mục đích)."},
{n:117,q:"It’s raining. Could you _____ me your umbrella?",c:["borrow","lend","until","remind"],a:1,e:"Lend = cho ai mượn; borrow = mượn của ai."},
{n:118,q:"During the day, they _____ time to finish the work.",c:["doesn’t have","didn’t have","not have","don’t"],a:1,e:"Hiện đơn phủ định với chủ ngữ số nhiều: they don’t have …"},
{n:119,q:"All of the people there_____ from Japan.",c:["were","is","be","was"],a:0,e:"The people → số nhiều → were."},
{n:120,q:"I went to the city _____ train.",c:["by","before","for","through"],a:0,e:"Di chuyển bằng phương tiện nói chung: by train."},
{n:121,q:"I’d better_____ to bed now to get up early in the morning.",c:["go","going","to go","went"],a:0,e:"Had better + V (nguyên mẫu)."},
{n:122,q:"Could you_____ me my red sweater, please?",c:["take","advise","borrow","bring"],a:3,e:"Bring (mang đến cho người nói); take (mang đi)."},
{n:123,q:"We have_____ solved the problem.",c:["already","could","yet","can"],a:0,e:"Present perfect thường đi với already/yet; already dùng trong khẳng định."},
{n:124,q:"We will get there_____ a few minutes.",c:["in","on","at","by"],a:0,e:"In + khoảng thời gian (trong … nữa)."},
{n:125,q:"Tomorrow morning, you have to be up _____ six o’clock.",c:["on","by","in","to"],a:1,e:"By + mốc thời gian: không muộn hơn …"},
{n:126,q:"The man_____ Linda spoke was her English teacher.",c:["who","whose","to whom","that"],a:2,e:"Speak to someone → to whom (mệnh đề quan hệ trang trọng)."},
{n:127,q:"Is the store_____ on Sundays?",c:["open","opens","will open","to opening"],a:0,e:"Open là tính từ chỉ trạng thái (mở cửa)."},
{n:128,q:"He is always very_____.",c:["patient","patience","patiently","impatiently"],a:0,e:"Cần tính từ mô tả người: patient."},
{n:129,q:"Neither of them knows how to cook, so they _____ eat out.",c:["often","seldom","rarely","never"],a:0,e:"Neither … knows (không ai biết nấu) → hậu quả hợp lý là họ **thường** (often) ăn ngoài. Nếu chọn *never* nghĩa là 'chưa bao giờ ăn ngoài' → mâu thuẫn logic."},
{n:130,q:"They went _____ Guam on vacation.",c:["with","to","for","about"],a:1,e:"Go to + nơi chốn."},
{n:131,q:"This one is more _____ than that one.",c:["cheap","cheaper","expensive","expensively"],a:2,e:"So sánh hơn dạng 'more + adj dài': more expensive."},
{n:132,q:"This black wallet is much _____ attractive than the brown one.",c:["too","more","so","as"],a:1,e:"Much + more + adj (nhấn mạnh so sánh hơn)."},
{n:133,q:"There are _____ workers picking cotton in the field.",c:["not","no","not never","no never"],a:1,e:"There are no + N số nhiều (không có …)."},
{n:134,q:"December 31st is the date _____ we meet every year.",c:["at which","through","on which","where"],a:2,e:"Ngày/thứ → on which."},
{n:135,q:"I have _____ money now than I had last year.",c:["fewer","much","less","a lot"],a:2,e:"Money là danh từ không đếm được → less (không dùng fewer)."},
{n:136,q:"Gary is late again. He’s never _____ time!",c:["on","at","the","rise"],a:0,e:"On time = đúng giờ."},
{n:137,q:"_____ you hear the bell, you need to leave the classroom.",c:["By the time","As","Whether","As soon as"],a:3,e:"As soon as + mệnh đề (ngay khi)."},
{n:138,q:"If I _____ help you, I would.",c:["might","shall","do","could"],a:3,e:"Câu điều kiện loại 2: If + past simple, … would + V. Động từ khuyết thiếu ở mệnh đề if → could."},
{n:139,q:"She was _____ smart that she scored the highest on the test.",c:["so","very","enough","too"],a:0,e:"So + adj + that …"},
{n:140,q:"He is much _____ in money than his brother is.",c:["for interested","for interesting","more interested","more interesting"],a:2,e:"Be interested in + N."},
{n:141,q:"Can I borrow _____ money?",c:["most","many","a","some"],a:3,e:"Some dùng được trong câu hỏi khi mong đợi trả lời 'yes'; money là không đếm được."},
{n:142,q:"Yesterday, I went to school _____ bus.",c:["over","by","on","with"],a:1,e:"By bus."},
{n:143,q:"_____ a tie, he couldn’t enter the restaurant.",c:["Not wearing","Wearing not","Don’t wear","Wear not"],a:0,e:"Rút gọn mệnh đề với V-ing phủ định: Not wearing + N."},
{n:144,q:"I don’t have ______ money.",c:["any","an","a","many"],a:0,e:"Any dùng trong phủ định với danh từ không đếm được."},
{n:145,q:"That movie was very ______.",c:["interest","interested","interesting","to interest"],a:2,e:"Adj đuôi -ing mô tả **vật** gây cảm xúc: interesting."},
{n:146,q:"They hope ______ to Singapore next year.",c:["travel","travels","traveling","to travel"],a:3,e:"Hope to + V."},
{n:147,q:"Put the milk ____ the top shelf of the fridge.",c:["on","in","over","behind"],a:0,e:"Đặt **trên** bề mặt kệ → on the shelf."},
{n:148,q:"Oops! I ______ a mistake!",c:["did","made","said","get"],a:1,e:"Collocation: make a mistake."},
{n:149,q:"My favorite color is ______.",c:["grapes","apple","orange","pear"],a:2,e:"Orange là tên màu; các đáp án còn lại là trái cây không dùng làm màu thông dụng."},
{n:150,q:"There are _____ students waiting for their teacher.",c:["a little","a few","most","almost"],a:1,e:"A few + danh từ đếm được số nhiều."},
];

const DE2 = [
{n:101,q:"I ______ two brothers.",c:["do","does","has","have"],a:3,e:"Be/Do/Have với 'I': I have …"},
{n:102,q:"______ you like strawberry ice cream?",c:["Are","Can","Do","Won’t"],a:2,e:"Câu hỏi hiện đơn với động từ thường dùng trợ động từ do/does."},
{n:103,q:"Where ______ he work?",c:["are","do","does","is"],a:2,e:"He → does."},
{n:104,q:"What will you ______ next weekend?",c:["do","doing","did","done"],a:0,e:"Will + V nguyên mẫu."},
{n:105,q:"He works ______ a doctor in that hospital.",c:["at","and","as","any"],a:2,e:"Work as + nghề nghiệp."},
{n:106,q:"I have no money. I’m ______.",c:["broken","breaking","break","broke"],a:3,e:"Broke = cháy túi (tính từ)."},
{n:107,q:"______ my friends take music lessons.",c:["Any","Any of","Many","Many of"],a:3,e:"Many of + my/these/those + plural noun."},
{n:108,q:"_____ students did their homework today.",c:["Most","Almost","Much","Each"],a:0,e:"Most + danh từ số nhiều."},
{n:109,q:"You seem _____ relaxing at the beach.",c:["to enjoy","enjoyed","enjoying","really enjoy"],a:0,e:"Seem to V."},
{n:110,q:"He wandered _____ far that he forgot his way home.",c:["so","very","such","really"],a:0,e:"So + adj/adv + that …"},
{n:111,q:"Many people were killed when the ship _____ in the harbor.",c:["explored","exploded","been explored","been exploded"],a:1,e:"Explode (nổ) → quá khứ đơn: exploded."},
{n:112,q:"Soccer is the sport _____ I like the most.",c:["who","whom","which","whose"],a:2,e:"Which thay thế cho vật/sự việc."},
{n:113,q:"The hotel _____ we stayed was built 100 years ago.",c:["when","that","which","at which"],a:3,e:"Stay at somewhere → at which."},
{n:114,q:"This lake is much _____ than the one near my house.",c:["deep","deeper","deeply","deepness"],a:1,e:"So sánh hơn: deeper."},
{n:115,q:"The mummy is the _____ object in the museum.",c:["boring","interesting","more interesting","most interesting"],a:3,e:"So sánh nhất: the most interesting."},
{n:116,q:"Sally _____more quickly than Steve.",c:["much","the","runs","running"],a:2,e:"Chủ ngữ số ít → runs."},
{n:117,q:"I have been very tired _____.",c:["late","lately","sometime","yet"],a:1,e:"Lately = dạo gần đây."},
{n:118,q:"Her skin would not burn _____ she wore sunscreen.",c:["because","so","neither","what"],a:0,e:"Because (bởi vì) → lý do không bị cháy nắng."},
{n:119,q:"We gave a thank-you card announcement _____ our teacher after the meeting.",c:["for","with","to","on"],a:2,e:"Give sth to sb."},
{n:120,q:"My mother bought a cell phone _____ my birthday present.",c:["to","for","at","in"],a:1,e:"For my present."},
{n:121,q:"My teacher told us that the school _____ in 1946.",c:["was built","was building","has been built","is built"],a:0,e:"Bị động quá khứ đơn cho sự kiện đã xong."},
{n:122,q:"I hurt my leg _____ the soccer match.",c:["by","during","been","over"],a:1,e:"During + danh từ sự kiện."},
{n:123,q:"We have enough money to buy ten hamburgers _____ you.",c:["for","into","about","with"],a:0,e:"Buy sth for sb."},
{n:124,q:"They prefer _____ through the streets at night.",c:["walking not","not walking","not to walking","not walk"],a:1,e:"Prefer + V-ing / prefer not V-ing."},
{n:125,q:"Could you give me_____ pens, please?",c:["other","another","whose","whom"],a:0,e:"Another + danh từ số ít đếm được."},
{n:126,q:"Our discussion turned _____ a big fight.",c:["in","into","to","at"],a:1,e:"Turn into = trở thành …"},
{n:127,q:"It’s impossible _____ a penguin to fly.",c:["to","that","for","if"],a:2,e:"Impossible for + O + to V."},
{n:128,q:"That’s the house roof _____ is leaking.",c:["where","into","which","whose"],a:3,e:"Whose + danh từ (sở hữu): whose roof …"},
{n:129,q:"My father has been working in the company _____ twenty years.",c:["to","at","for","in"],a:2,e:"For + khoảng thời gian (đã kéo dài được …)."},
{n:130,q:"I don’t have enough time _____ for you.",c:["wait","to wait","waiting","waited"],a:1,e:"Enough time to V."},
{n:131,q:"I’ve been learning English ______ three years.",c:["in","over","since","while"],a:1,e:"Over three years ≈ for three years (khẩu ngữ chấp nhận)."},
{n:132,q:"I got up _____ seven o’clock this morning.",c:["in","at","on","from"],a:1,e:"At + giờ."},
{n:133,q:"The students, as well as the teacher, _____ happy about the test results.",c:["has","is","was","were"],a:1,e:"Động từ theo **chủ ngữ trước** 'as well as': The students … is (nhiều tài liệu khuyên dùng số ít theo 'the teacher', song đề này chốt 'is' theo đáp án chuẩn cho sẵn)."},
{n:134,q:"_____ people are not happy with the class.",c:["A number of","Most of","Every","Many a"],a:0,e:"A number of + danh từ số nhiều (nhiều …)."},
{n:135,q:"What did she_____ you to do?",c:["speak","advice","tell","say"],a:2,e:"Tell sb to do sth."},
{n:136,q:"I _____ the book already.",c:["will read","have read","reading","been read"],a:1,e:"Hiện hoàn thành (đã đọc rồi): have read."},
{n:137,q:"I _____ about the funny story before he told me.",c:["hear","have heard","had heard","was hearing"],a:2,e:"QKHT: had heard … before he told me."},
{n:138,q:"Joseph told me he _____ his project.",c:["had already finished","already finishes","finishing","had been already finishing"],a:0,e:"Tường thuật quá khứ lùi thì: had already finished."},
{n:139,q:"All of the food _____ prepared by seven.",c:["was","were","have","has"],a:0,e:"Food là danh từ không đếm được → was."},
{n:140,q:"We would_____ out. It’s freezing outside.",c:["not rather go","not rather to go","rather not to go","rather not go"],a:3,e:"Would rather not + V."},
{n:141,q:"Would you like_____ with me?",c:["to","to go shopping","shopping to","shop to go"],a:1,e:"Would you like to go shopping …?"},
{n:142,q:"They always _____ the expensive shoes.",c:["try on","tries on","trying on","had tried on"],a:0,e:"They + V (nguyên mẫu số nhiều): try on."},
{n:143,q:"The robber _____ the money when the police arrived.",c:["count","was counting","are counting","were counting"],a:1,e:"QKTD: was counting … when … arrived."},
{n:144,q:"My wife _____ work at the GoodAll Company.",c:["was","used to","interested in","was accustomed to"],a:1,e:"Used to + V (đã từng)."},
{n:145,q:"The manager _____ us to return the DVD before noon today.",c:["would like","likes","is liking","liked"],a:0,e:"Would like + O + to V."},
{n:146,q:"I can’t come to the party because I’m going _____.",c:["shopping","shop","shopped","shops"],a:0,e:"Be going shopping."},
{n:147,q:"I have worked for my _____ for two years.",c:["employee","apply","employer","work"],a:2,e:"Employer = chủ sử dụng lao động."},
{n:148,q:"I eat lunch _____ school every day.",c:["at","once","twice","now"],a:0,e:"At school."},
{n:149,q:"We’ve _____ to London three times.",c:["going","go","went","been"],a:3,e:"Have been to + nơi (đã từng đến)."},
{n:150,q:"She _____ on the phone since I came in.",c:["talks","talked","has been talking","talking"],a:2,e:"Hiện hoàn thành tiếp diễn: has been talking."},
];

const DE3 = [
{n:101,q:"I like tea, -------- my wife doesn’t.",c:["and","or","but","so"],a:2,e:"Quan hệ tương phản → but."},
{n:102,q:"Is Jean Michel Basquiat known -------- young people in Korea?",c:["by","to","as","for"],a:1,e:"Be known to + người; be known for + danh tiếng/vì điều gì."},
{n:103,q:"The subject is --------- discussed by the students.",c:["been","be","being","to be"],a:2,e:"Hiện tiếp diễn bị động: is being discussed."},
{n:104,q:"---------- the economy is booming, our sales are going up.",c:["Though","Because","That","Or"],a:1,e:"Mệnh đề nguyên nhân → because."},
{n:105,q:"We have met before, ---------?",c:["don’t we","have we","haven’t we","aren’t we"],a:2,e:"Tag question của present perfect → haven't we?"},
{n:106,q:"The report must --------- in English.",c:["type","typed","be typed","typing"],a:2,e:"Modal + be + V3 (bị động): must be typed."},
{n:107,q:"We’ll read a report -------- the new business.",c:["explain","explained","explains","explaining"],a:3,e:"Danh từ + V-ing (mệnh đề rút gọn) bổ nghĩa: a report explaining …"},
{n:108,q:"It is necessary --------- of the problem.",c:["think","to think","thought","thinks"],a:1,e:"It is adj + to V."},
{n:109,q:"I heard the bell ----------.",c:["rings","to ring","rung","ringing"],a:3,e:"Perception verb + O + V-ing: heard the bell ringing."},
{n:110,q:"The computer solves problems by ------ data.",c:["processes","to process","processing","process"],a:2,e:"By + V-ing."},
{n:111,q:"We told Jack -------- with us.",c:["to come","come","came","coming"],a:0,e:"Tell + O + to V."},
{n:112,q:"------- say such a thing again.",c:["Not","Don’t","No","None"],a:1,e:"Mệnh lệnh phủ định → Don’t + V."},
{n:113,q:"When he ------- the classroom, we were studying.",c:["entered","entered in","entered into","entered to"],a:0,e:"Enter + nơi chốn (không giới từ)."},
{n:114,q:"The plane leaves from Chicago at nine, -------- in New York at eleven.",c:["arrive","arriving","to arrive","arrives"],a:1,e:"Mệnh đề rút gọn V-ing chỉ kết quả: …, arriving in …"},
{n:115,q:"We are planning ------ you the job.",c:["to offer","offering","offer","offered"],a:0,e:"Plan to V; offer sb sth."},
{n:116,q:"Will you sing a song ----- the children?",c:["at","for","of","from"],a:1,e:"Sing for sb."},
{n:117,q:"He’s very funny. He always makes us ------.",c:["laughing","laughed","laugh","to laugh"],a:2,e:"Make + O + V (bare): makes us laugh."},
{n:118,q:"-------- beautiful women they are!",c:["What","How","Be","Look at"],a:0,e:"What + adj + plural noun!"},
{n:119,q:"Robert was too busy --------- lunch.",c:["eating","to eat","eats","eat"],a:1,e:"Too … to V (quá … nên không thể …)."},
{n:120,q:"What have you decided -------- tonight?",c:["do","to do","doing","done"],a:1,e:"Decide to V."},
{n:121,q:"There are many places -------- in Cheju-do.",c:["see","seeing","to see","seen"],a:2,e:"N + to V (bổ nghĩa mục đích): places to see."},
{n:122,q:"Strangely, there were no benches -------- on in the park.",c:["sitting","sat","to sit","sit"],a:2,e:"Benches to sit on (cấu trúc giới từ cuối)."},
{n:123,q:"Did you have your passport ---------?",c:["steal","stole","stolen","to steal"],a:2,e:"Have + O + V3 (bị gây ra/để cho làm): have your passport stolen."},
{n:124,q:"I don’t mind ------- alone.",c:["am","being","be","to be"],a:1,e:"Mind + V-ing."},
{n:125,q:"I went to Busan ------- my uncle’s.",c:["to visit","visiting","visit","visited"],a:0,e:"Mục đích: to visit."},
{n:126,q:"The meat ----------.",c:["went bad","went badly","got bad","turned badly"],a:0,e:"Go bad = hỏng/ôi thiu (liên kết động từ + adj)."},
{n:127,q:"There was a tree --------- down in the storm.",c:["blows","blew","blowing","blown"],a:3,e:"Bị động quá khứ phân từ: blown down."},
{n:128,q:"It is easy -------- him to swim across the river.",c:["for","of","in","to"],a:3,e:"It is easy (for sb) to V → to swim (for him)."},
{n:129,q:"I’ll -------- you know by phone.",c:["ask","let","want","tell"],a:1,e:"Let sb know …"},
{n:130,q:"He was not satisfied --------- his salary.",c:["by","at","with","on"],a:2,e:"Satisfied with …"},
{n:131,q:"A trip to another country ------- a lot of preparation.",c:["need","needs","needing","necessary"],a:1,e:"Chủ ngữ số ít (A trip) → needs."},
{n:132,q:"------- there alone was dangerous",c:["Go","Going","Went","Gone"],a:1,e:"V-ing làm chủ ngữ."},
{n:133,q:"Lisa is hungry --------- she didn’t have breakfast.",c:["because","that","and","so"],a:0,e:"Because … (vì)."},
{n:134,q:"It’s a nice house -------- it hasn’t got a garage.",c:["that","and","or","but"],a:3,e:"Tương phản → but."},
{n:135,q:"Who ------- these books belong to?",c:["are","has","does","do"],a:3,e:"Books (số nhiều) → do these books belong to?"},
{n:136,q:"She is --------------.",c:["happiness","a famous actress","kindly","noisily"],a:1,e:"Bổ ngữ danh từ sau be: a famous actress."},
{n:137,q:"The sky is getting -----------.",c:["dark","brightly","darkly","well"],a:0,e:"Get + adj (tối dần)."},
{n:138,q:"How many students --------- there in the class?",c:["studying","do","was","are"],a:3,e:"There are …? → are."},
{n:139,q:"I want --------- the picture.",c:["see","seeing","to see","saw"],a:2,e:"Want to V."},
{n:140,q:"She loves ---------.",c:["pretty","him","kind","see pictures"],a:1,e:"Đại từ tân ngữ: loves him."},
{n:141,q:"We will send them ----------.",c:["present","to presents","presents","for presents"],a:2,e:"Send sb sth (song tân ngữ)."},
{n:142,q:"It isn’t necessary -------- back to the first store.",c:["go","to go","went","goes"],a:1,e:"Be necessary to V."},
{n:143,q:"He wanted something --------- after jogging.",c:["drink","drinking","drank","to drink"],a:3,e:"Something to drink (to-inf bổ nghĩa danh từ bất định)."},
{n:144,q:"The teacher tries -------- the grammar point.",c:["explain","to explain","explains","to explaining"],a:1,e:"Try to V (cố gắng làm)."},
{n:145,q:"------- a lot of money isn’t always necessary.",c:["Make","I make","Making","To making"],a:2,e:"Gerund (V-ing) làm chủ ngữ: Making a lot of money …"},
{n:146,q:"Would you mind -------- door?",c:["close","closing","to close","closed"],a:1,e:"Would you mind + V-ing …?"},
{n:147,q:"Do you know the -------- girl?",c:["sing","sang","singing","song"],a:2,e:"Danh từ + hiện phân từ: the singing girl (cô gái đang hát)."},
{n:148,q:"Many people -------- to the party couldn’t come.",c:["invites","inviting","to invite","invited"],a:3,e:"Mệnh đề rút gọn bị động: people invited …"},
{n:149,q:"English ------- spoken in Canada.",c:["does","is","are","was"],a:1,e:"English (ngôn ngữ) số ít → is spoken."},
{n:150,q:"He was arrested for drunk driving ------ the police.",c:["in","by","to","for"],a:1,e:"Bị động tác nhân: by the police."},
];

const DE4 = [
{n:101,q:"Can you finish your homework -------- next Thursday?",c:["then","by","until","till"],a:1,e:"By + mốc thời gian = không muộn hơn …"},
{n:102,q:"Nowadays, most ------- have four wheels.",c:["cars","of the cars","the cars","among the cars"],a:0,e:"Most + plural noun."},
{n:103,q:"There are -------- more books that are beneficial to you.",c:["so","many","such","much"],a:1,e:"Many more + danh từ đếm được."},
{n:104,q:"He ------- that smoking indoors not be allowed under any circumstances.",c:["refuses","insists","conditions","regulates"],a:1,e:"Insist that + (should) + V nguyên mẫu (thức giả định)."},
{n:105,q:"This program is ------- harder to get accustomed to than the old one.",c:["such","so many","very","much"],a:3,e:"Much + so sánh hơn (nhấn mạnh): much harder."},
{n:106,q:"When he got home, his wife ------ dinner.",c:["fix","fixes","fixing","was fixing"],a:3,e:"QKTD: was fixing."},
{n:107,q:"The Joneses must have left at least one week -------.",c:["since","ago","advanced","during"],a:1,e:"Ago + khoảng thời gian (trước đây …)."},
{n:108,q:"There was ------- left in the safe.",c:["two-hundred dollar bills","two-hundreds dollar bills","two-hundred dollars","two-hundreds dollars"],a:2,e:"Hai trăm đô la: two hundred dollars (hundred không thêm s khi đứng trước số)."},
{n:109,q:"-------- at a distance, it looks like a miniature city.",c:["Seen","Seeing","Having seen","Having been seen"],a:0,e:"Rút gọn mệnh đề bị động: Seen at a distance, …"},
{n:110,q:"This math problem -------- solved in ten minutes.",c:["will able to be","be able to is","is ably","can be"],a:3,e:"Can be + V3."},
{n:111,q:"Though they look very much alike, the two brothers have ------- personalities.",c:["different","difficult","varied","differentiated"],a:0,e:"Different personalities."},
{n:112,q:"The new employee is neither ambitious -------- hardworking.",c:["or","nor","and","as well as"],a:1,e:"Neither … nor …"},
{n:113,q:"He wouldn’t leave the platform -------- her train went out of sight.",c:["so that","until","so","therefore"],a:1,e:"Until = cho đến khi."},
{n:114,q:"We had -------- stay out too late.",c:["not rather","rather","not better","better not"],a:3,e:"Had better not + V."},
{n:115,q:"Brian was seen --------- his car.",c:["washing","wash","have washed","washed"],a:0,e:"Be seen + V-ing/V (bare). Hành động đang diễn ra → washing."},
{n:116,q:"For more -------, contact us at 721-3431.",c:["informations","informed","further information","information"],a:2,e:"Uncountable noun: information; collocation: further information."},
{n:117,q:"Carry an umbrella -------- in case it should rain.",c:["with you","by you","with yourself","by yourself"],a:0,e:"Carry sth with you."},
{n:118,q:"A customer asked to see the manager -------.",c:["in face","in front","in person","indirect"],a:2,e:"In person = trực tiếp."},
{n:119,q:"The woman in black comes from a -------- family.",c:["respecting","respects","respectable","respective"],a:2,e:"Respectable (đáng kính, đàng hoàng)."},
{n:120,q:"This is the third time that the lenses of my glasses have ------- broken.",c:["all","both","each","any"],a:1,e:"Kính có hai tròng → both."},
{n:121,q:"My umbrella --------- by that terrible wind this morning.",c:["broke","was broken","break","had broken"],a:1,e:"Bị động quá khứ đơn với trạng từ thời gian cụ thể (this morning): was broken."},
{n:122,q:"He wanted ------ the exam.",c:["to not fail","not to fail","to fail not","failing not"],a:1,e:"Not to V (phủ định của to-infinitive)."},
{n:123,q:"------- the research uncovered some problems, the company decided to stop the project.",c:["Since","Wherever","Despite","Even though"],a:0,e:"Since = vì/bởi vì."},
{n:124,q:"They say that the ------- has not yet been decided.",c:["deadline","finishing line","clothes line","underline"],a:0,e:"Deadline (hạn chót)."},
{n:125,q:"With only one more week, he --------- better prepared for the concert last Saturday.",c:["could have been","could be","could well have","could well be"],a:0,e:"Hồi tưởng quá khứ không đạt được → could have been."},
{n:126,q:"The photocopier needs ---------.",c:["to fix","to be fix","fixing","to be fixing"],a:2,e:"Need + V-ing (BrE) ≈ need to be V3."},
{n:127,q:"Brian and Diana phone ------- almost every day.",c:["themselves","themself","each other","the other"],a:2,e:"Each other (lẫn nhau)."},
{n:128,q:"Let’s take another ------ at the sales figure.",c:["view","scene","glance","vision"],a:2,e:"Take a glance at …"},
{n:129,q:"It is reported that the boat ------- about 60 miles off the coast of South Africa.",c:["disappeared","was disappeared","was being disappeared","has been disappeared"],a:0,e:"Disappear là nội động từ → không dùng bị động."},
{n:130,q:"I am considering ----------.",c:["taking a new job","to take a new job","take a new job","do take a new job"],a:0,e:"Consider + V-ing."},
{n:131,q:"What will become ------- the child now that his parents are gone?",c:["with","at","of","to"],a:2,e:"What will become of …? (số phận/điều gì sẽ xảy ra với …)"},
{n:132,q:"The instructor told us ------ to find the book.",c:["whom","which","where","what"],a:2,e:"Tell sb where to V."},
{n:133,q:"There are few mothers -------- don’t love their own children.",c:["who","which","but","except"],a:0,e:"Đại từ quan hệ chỉ người: who."},
{n:134,q:"More and more overseas visitors are coming to this city to ----- clothes.",c:["bought","with buy","after buying","buy"],a:3,e:"To + V (mục đích)."},
{n:135,q:"Who is that man ------ black?",c:["wears","is wearing","wear","wearing"],a:3,e:"Rút gọn phân từ hiện tại: the man wearing black."},
{n:136,q:"-------- in a lake is very different from swimming in an ocean.",c:["To swim","Swimming","To be swimming","Swim"],a:1,e:"V-ing làm chủ ngữ tự nhiên."},
{n:137,q:"There are no -------- between the brothers.",c:["same","difference","similarities","variation"],a:2,e:"No similarities between …"},
{n:138,q:"In addition to English, my daughter can ------- French.",c:["talk","say","speak","tell"],a:2,e:"Speak + ngôn ngữ."},
{n:139,q:"On my trip to Italy, not only -------- a suitcase, but I broke my glasses.",c:["I lost","I lose","lost I","did I lose"],a:3,e:"Đảo ngữ với 'not only' → Not only **did I lose** …"},
{n:140,q:"Since the early 1990s, the demand for personal computers --------.",c:["steadily increases","steadily increase","has been steadily increasing","are steadily increasing"],a:2,e:"Hiện hoàn thành tiếp diễn với mốc 'since'."},
{n:141,q:"Who does she -------- to take care of her?",c:["want","wants","to want","will want"],a:0,e:"Do/does + S + V (bare): does she want …"},
{n:142,q:"They are considering -------- to Atlanta.",c:["move","to move","moving","will move"],a:2,e:"Consider + V-ing."},
{n:143,q:"I would like ------ by your office on my way home.",c:["drop","to drop","dropping","will drop"],a:1,e:"Would like to V."},
{n:144,q:"They politely asked me ------- in another place.",c:["stand","to stand","standing","stood"],a:1,e:"Ask + O + to V."},
{n:145,q:"Since we live by an airport, we can easily watch the airplanes ------ off.",c:["take","to take","be taking","will take"],a:0,e:"Verb of perception + O + V (bare): watch the airplanes take off."},
{n:146,q:"My son is not very good at ------- yet.",c:["drive","to drive","driving","will drive"],a:2,e:"Be good at + V-ing."},
{n:147,q:"Now we are going to ------ about our plans for next year.",c:["discuss","tell","talk","say"],a:2,e:"Talk about (thảo luận/trao đổi)."},
{n:148,q:"Please keep me -------- as to his whereabouts.",c:["interred","informed","deformed","reformed"],a:1,e:"Keep sb informed (giữ cho … được thông tin)."},
{n:149,q:"I’m looking forward to ------- from you soon.",c:["hear","hearing","heard","have heard"],a:1,e:"Look forward to + V-ing."},
{n:150,q:"Mother -------- me clean the floor with a mop.",c:["got","made","forced","told"],a:1,e:"Make + O + V (bare): made me clean …"},
];

const DE5 = [
{n:101,q:"The room was ------- noisy that no one was able to hear the announcement.",c:["so","such","as","very"],a:0,e:"So + adj + that … → so noisy that …"},
{n:102,q:"There is construction going on outside today, so please ------ the windows closed.",c:["stay","remain","let","keep"],a:3,e:"Keep + O + adj: keep the windows closed."},
{n:103,q:"One of the requirements of this position is that you show up every day ------- of the weather.",c:["despite","nonetheless","regardless","although"],a:2,e:"Regardless of (bất kể)."},
{n:104,q:"The house Mr. Eno is thinking about buying is located ------- Heritage Street.",c:["to","on","from","of"],a:1,e:"On + tên đường."},
{n:105,q:"The manager hinted that Janet Tate -------- for a promotion.",c:["considers","has been considering","has considered","is being considered"],a:3,e:"Bị động hiện tiếp diễn: is being considered (đang được xem xét)."},
{n:106,q:"If you do not find the accommodations here----------, be sure to let us know …",c:["satisfactory","satisfied","satisfaction","satisfactorily"],a:0,e:"Be + adj: satisfactory (đạt yêu cầu)."},
{n:107,q:"Please inform Ms. Anne Hedoni that we suggest she ------- her appointment for at least a week.",c:["postpone","is postponing","postpones","will postpone"],a:0,e:"Thức giả định sau suggest: (that) she postpone (V nguyên dạng)."},
{n:108,q:"Trying to force one’s religious beliefs on someone else is futile, for no one can -------- another person believe anything.",c:["let","impose","make","get"],a:2,e:"Make sb + V = khiến ai làm gì."},
{n:109,q:"… many people have stopped buying ------ razors.",c:["unusable","disposable","temporary","impermanent"],a:1,e:"Disposable razors = dao cạo dùng một lần."},
{n:110,q:"The suspect ------- the detective’s accusation that he was involved with organized crime.",c:["denied","declined","exclaimed","unclaimed"],a:0,e:"Deny an accusation (phủ nhận cáo buộc)."},
{n:111,q:"… you will be provided ------ all required materials.",c:["to","with","for","about"],a:1,e:"Provide sb with sth."},
{n:112,q:"The restaurant manager was replaced because of her inability ------- discipline among her employees.",c:["maintaining","maintained","to maintain","being maintained"],a:2,e:"Inability to + V."},
{n:113,q:"---------- by the Union chief's argument …, company management refused …",c:["Moved","Moving","Unmoved","Unmoving"],a:2,e:"Unmoved = không lay chuyển (không bị thuyết phục)."},
{n:114,q:"… consider not only … qualifications …, but also his or her ---------.",c:["character","characters","characteristic","caricatures"],a:0,e:"Character = tính cách/phẩm chất."},
{n:115,q:"The agreement was concluded --------- precisely 11:03 p.m. on November 27th.",c:["near","on","at","to"],a:2,e:"At + giờ."},
{n:116,q:"Dr. Scobie is about to complete his research, the results of --------- he hopes to have published …",c:["whose","it","which","that"],a:2,e:"The results of which … (mệnh đề quan hệ giới từ hóa)."},
{n:117,q:"Reverend Al Dulton may not be the most --------- speaker, but he always succeeds in getting his point across.",c:["elemental","eloquent","eclectic","essential"],a:1,e:"Eloquent = hùng biện."},
{n:118,q:"Springfield has the ------- of being one of the nation’s safest places to live.",c:["reputes","reputed","reputing","reputation"],a:3,e:"Have the reputation of …"},
{n:119,q:"Everyone -------- Ms. St. John has submitted an application.",c:["to","but","from","for"],a:1,e:"Everyone but … = ngoài …"},
{n:120,q:"Because he knew he was being observed, Curtis had trouble ------- on his work.",c:["concentrates","concentrating","concentrated","concentration"],a:1,e:"Have trouble + V-ing."},
{n:121,q:"The speech, ------ quite long, succeeded in holding the interest of the audience …",c:["though","needless","factually","however"],a:0,e:"Though + adj (rút gọn mệnh đề nhượng bộ)."},
{n:122,q:"They probably ------ dinner by the time we get there.",c:["had finished","have finished","will have finished","will have been finishing"],a:2,e:"TLHT (future perfect): will have finished by …"},
{n:123,q:"… assigned to the night ----------.",c:["crew","clan","cast","call"],a:0,e:"Night crew = kíp đêm."},
{n:124,q:"It should be understood that the ------- of a solid customer base …",c:["creativity","creation","creature","creator"],a:1,e:"The creation of …"},
{n:125,q:"… but ------- the whole, the development of the automobile …",c:["at","in","to","on"],a:3,e:"On the whole = nhìn chung."},
{n:126,q:"… inform employees of new regulations and ------ management of ways to ensure compliance …",c:["advice","advise","advisor","advisory"],a:1,e:"Động từ: advise."},
{n:127,q:"For the most part, ------- in technology stocks have seen the value of their shares increase …",c:["investing","investment","investors","investiture"],a:2,e:"Investors (nhà đầu tư)."},
{n:128,q:"We regret -------- your office of the changes to the program earlier …",c:["to inform","not having informed","not to inform","the informing of"],a:1,e:"Regret not having V3 … (hối tiếc vì đã không …)."},
{n:129,q:"Employees … are strongly encouraged to make suggestions as ------- how workplace safety might be improved.",c:["to","of","if","in"],a:0,e:"As to how … (về việc làm thế nào …)."},
{n:130,q:"Representatives of this firm must never ------- to high-pressure or deceitful sales tactics …",c:["succumb","resolve","submit","resort"],a:3,e:"Resort to = dùng đến/nhờ đến."},
{n:131,q:"Hardly -------- surveyed expressed interest in either of the product offerings …",c:["anyone","no one","those","of those"],a:0,e:"Hardly anyone … (hầu như không ai)."},
{n:132,q:"COLAs … exist to ensure that the value of pensions is not ------- by inflation.",c:["declassified","defended","decreased","deceived"],a:2,e:"Not decreased by …"},
{n:133,q:"In this economic climate, it is difficult to cover expenses, ------- achieve a profit.",c:["evermore","more or less","much less","as much as"],a:2,e:"Much less = huống chi/chứ đừng nói …"},
{n:134,q:"The television advertisement was so effective that customer service representatives had a difficult time ------ with the sudden increase in incoming calls.",c:["holding down","putting through","keeping up","taking over"],a:2,e:"Keep up with = bắt kịp/đáp ứng."},
{n:135,q:"News ------- of our financial difficulties has hurt our chances of completing the merger.",c:["uncovering","coverage","uncovers","covering"],a:1,e:"News coverage (sự đưa tin)."},
{n:136,q:"There have been several production line injuries attributable to worker -------;",c:["diligence","fatigue","wages","Insurance"],a:1,e:"Fatigue = mệt mỏi, kiệt sức."},
{n:137,q:"Attendance at the workshop is ----- for all faculty members …",c:["mandatory","laudatory","exemplary","disciplinary"],a:0,e:"Mandatory = bắt buộc."},
{n:138,q:"Declines in absenteeism and increased ------- led the company to … pay raises.",c:["productivity","produce","productions","producers"],a:0,e:"Increased productivity."},
{n:139,q:"… I overheard someone ------- that your application for transfer had been rejected …",c:["say","said","to say","had said"],a:0,e:"Overhear sb say …"},
{n:140,q:"Ms. Oliver wishes to express her concern ------- the decision not to review the safety procedures.",c:["regard","regarding","regards","regardless"],a:1,e:"Regarding = về/đối với."},
{n:141,q:"The files were ------- alphabetically.",c:["organization","organizer","organize","organized"],a:3,e:"Bị động QKĐ: were organized …"},
{n:142,q:"The business consultant suggested a ------- sales plan.",c:["modify","modifies","modified","modifying"],a:2,e:"A modified plan (tính từ V3 bổ nghĩa danh từ)."},
{n:143,q:"------- there were so many customer complaints, we withdrew the item from the market.",c:["Therefore","Because","Although","However"],a:1,e:"Because + mệnh đề nguyên nhân."},
{n:144,q:"The ------- report will be published next Monday.",c:["selling","sales","sell","sells"],a:1,e:"Sales report (báo cáo bán hàng)."},
{n:145,q:"The architect must consider every detail of a floor -------.",c:["planning","plan","plans","planned"],a:1,e:"A floor plan (bản vẽ mặt bằng)."},
{n:146,q:"Mr. Lafferty wants to meet ------- six o'clock sharp.",c:["on","upon","at","during"],a:2,e:"At + giờ."},
{n:147,q:"The ------- of the office party must take responsibility for the cleanup.",c:["plans","planning","planned","planners"],a:3,e:"The planners (những người tổ chức)."},
{n:148,q:"------- the new product didn't sell well, it's still on the market.",c:["However","So that","Although","Nevertheless"],a:2,e:"Although …, …"},
{n:149,q:"The crew worked ------- to avoid problems in the future.",c:["careful","carefully","care","more careful"],a:1,e:"Trạng từ: carefully."},
{n:150,q:"Demand for the new line of cars is up; -------, production will increase.",c:["however","despite","therefore","regardless"],a:2,e:"Therefore = vì thế/do đó."},
];

/* =================== TIỆN ÍCH =================== */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function escapeHTML(s){
  return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
}

/* =================== GHÉP NGUỒN & DOM =================== */
const BANK = {de1:DE1,de2:DE2,de3:DE3,de4:DE4,de5:DE5};

const MODE_SELECT = document.getElementById('modeSelect');
const QUIZ = document.getElementById('quiz');
const SCORE = document.getElementById('score');
const TOTAL = document.getElementById('total');
const BTN_START = document.getElementById('btnStart');
const BTN_SHUF = document.getElementById('btnShuffle');
const BTN_SHOW = document.getElementById('btnShowAll');
const BTN_RESET = document.getElementById('btnReset');
const INPUT_SEARCH = document.getElementById('search');

let workingSet = [];
let score = 0;

/* ========== TẠO THẺ CÂU HỎI (ĐÃ FIX ĐÁP ÁN ĐÚNG SAU KHI XÁO) ========== */
function buildQuestionCard(q){
  const card = document.createElement('div');
  card.className='card';
  card.dataset.locked='0';

  const head = document.createElement('div');
  head.className='qhead';
  head.innerHTML = `
    <div class="qid">#${q.n}</div>
    <div class="qtext">${escapeHTML(q.q)}</div>
  `;
  card.appendChild(head);

  const optsWrap = document.createElement('div');
  optsWrap.className='opts';

  // Tạo mảng đáp án và XÁO TRỘN vị trí
  const choiceObjs = q.c.map((t,i)=>({t,idx:i,correct:i===q.a}));
  shuffle(choiceObjs);

  // Lấy vị trí đáp án đúng SAU KHI XÁO để hiển thị chữ cái chính xác
  const correctShuffledIndex = choiceObjs.findIndex(co => co.correct);
  const correctLetter = "ABCD"[correctShuffledIndex];
  const correctText   = choiceObjs[correctShuffledIndex].t;

  // Render lựa chọn
  choiceObjs.forEach((co, i)=>{
    const opt = document.createElement('button');
    opt.type='button';
    opt.className='opt';
    opt.dataset.correct = co.correct ? '1':'0';
    opt.innerHTML = `<span class="label">${['A','B','C','D'][i]}.</span> ${escapeHTML(co.t)}`;

    opt.addEventListener('click', ()=>{
      if(card.dataset.locked==='1') return;

      const exp = card.querySelector('.explain');

      if(opt.dataset.correct==='1'){
        // Chọn ĐÚNG
        opt.classList.add('correct');
        card.dataset.locked='1';
        card.querySelectorAll('.opt').forEach(o=>o.classList.add('locked'));
        exp.classList.add('show');
        if(card.dataset.scored!=='1'){
          score++; card.dataset.scored='1';
          SCORE.textContent = score;
        }
      }else{
        // Chọn SAI → đánh dấu sai + tô xanh đáp án đúng + khóa + hiện giải thích
        opt.classList.add('wrong');
        const right = Array.from(card.querySelectorAll('.opt')).find(o=>o.dataset.correct==='1');
        if(right){ right.classList.add('correct'); }
        card.dataset.locked='1';
        card.querySelectorAll('.opt').forEach(o=>o.classList.add('locked'));
        exp.classList.add('show');
      }
    });

    optsWrap.appendChild(opt);
  });

  // Khung giải thích: ghi rõ chữ cái & nội dung đáp án đúng sau khi xáo
  const exp = document.createElement('div');
  exp.className='explain';
  exp.innerHTML = `
    ✅ <b>Đáp án đúng: ${correctLetter}. ${escapeHTML(correctText)}</b><br>
    💡 <b>Giải thích:</b> ${escapeHTML(q.e)}
  `;

  card.appendChild(optsWrap);
  card.appendChild(exp);
  return card;
}

/* =================== RENDER =================== */
function render(list){
  QUIZ.innerHTML='';
  list.forEach(q=>QUIZ.appendChild(buildQuestionCard(q)));
  score=0;
  SCORE.textContent=score;
  TOTAL.textContent=list.length;
}

/* =================== LẤY BỘ CÂU THEO CHẾ ĐỘ =================== */
function getModeSet(){
  const mode = MODE_SELECT.value;
  if (mode === 'mix45') {
    const all = [...DE1, ...DE2, ...DE3, ...DE4, ...DE5];
    shuffle(all);
    return all.slice(0,45);
  } else {
    // Luyện theo đề: GIỮ THỨ TỰ 101→150
    return [...BANK[mode]];
  }
}

/* =================== ĐIỀU KHIỂN =================== */
function start(){
  const mode = MODE_SELECT.value;
  workingSet = getModeSet();
  if (mode === 'mix45') shuffle(workingSet); // chỉ xáo thứ tự câu ở chế độ trộn 45
  render(workingSet);

  BTN_SHUF.disabled = (mode !== 'mix45');
  BTN_SHUF.title = (mode === 'mix45')
    ? "Xáo trộn lại thứ tự 45 câu hiện tại"
    : "Chỉ trộn ở chế độ Trộn 5 đề (đề luyện tập giữ thứ tự 101→150)";
}

function shuffleAgain(){
  if (MODE_SELECT.value !== 'mix45') return;
  shuffle(workingSet);
  render(workingSet);
}

function showAll(){
  // Mở toàn bộ giải thích + đánh dấu xanh đáp án đúng
  document.querySelectorAll('.card').forEach(card=>{
    const exp = card.querySelector('.explain');
    if(exp) exp.classList.add('show');
    const right = card.querySelector('.opt[data-correct="1"]');
    if(right){ right.classList.add('correct'); }
    card.querySelectorAll('.opt').forEach(o=>o.classList.add('locked'));
    card.dataset.locked='1';
  });
}

function resetAll(){
  if(!workingSet || workingSet.length===0) return;
  render(workingSet);
}

function filterByKeyword(){
  const kw = INPUT_SEARCH.value.trim().toLowerCase();
  if(!kw){ render(workingSet); return; }
  const filtered = workingSet.filter(q=>{
    const text = [q.n, q.q, ...q.c, q.e].join(' ').toLowerCase();
    return text.includes(kw);
  });
  render(filtered);
}

/* =================== GẮN SỰ KIỆN =================== */
BTN_START.addEventListener('click', start);
BTN_SHUF.addEventListener('click', shuffleAgain);
BTN_SHOW.addEventListener('click', showAll);
BTN_RESET.addEventListener('click', resetAll);
INPUT_SEARCH.addEventListener('input', filterByKeyword);

// Khởi tạo mặc định: Trộn 45 câu
start();
</script>

</body>
</html>
